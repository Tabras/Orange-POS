<%inherit file="/base/index.html" />
<%namespace file="/base/confirmModal.html" import="delete_modal"/>
<%namespace file="/base/uiHelpers.html" import="pager"/>

<div class="page-header">
	<h1 class="pull-left">Customers</h1>
  	<div class="pull-right">
		<a class="btn primary" style="margin-right:10px; height:15px;" 
			href="${request.route_url('customer_new')}">Add New Customer</a>
		<div id="quicksearch" class="search-box">
			<form method="get" action="${request.route_url('customer_list')}">
				<input name="search" type="text" value="" placeholder="Search">
			</form>
		</div>
	</div>
</div>

<div class="row">
	<div class="span14">
		
	% if len(customers):
		<table class="condensed-table zebra-striped sortable">
			<thead>
				<tr>
					<th style="width: 300px;">
						${self.sortable('company_name')}
					</th>
					<th>
						${self.sortable('contact_first_name')}
					</th>
					<th>
						${self.sortable('contact_last_name')}
					</th>
					<th>
						${self.sortable('category')}
					</th>
					<th style="width: 130px;"></th>
				</tr>
			</thead>
			<tbody>
				% for item in customers:
		        <tr>
			        <td valign="top">
						<a href="/customers/${item.id}/edit">       	
			            	${item.company_name}
			        	</a>
			        </td>
			        <td valign="top">
						<a href="/customers/${item.id}/edit">       	
			        		${item.contact_first_name}
			        	</a>
			        </td>
			        <td valign="top">
						<a href="/customers/${item.id}/edit">       	
			        		${item.contact_last_name}
			        	</a>
			        </td>
			        <td valign="top">
						<a href="/customers/${item.id}/edit">       	
			        		${item.category.name}
			        	</a>
			        </td>
			        <td valign="top">
			        	<a class="btn" href="/customers/${item.id}/edit" style="height: 14px;">
			        		Edit
			        	</a>
			        	<a class="btn" style="height: 14px;" data-controls-modal="confirm-modal" 
			        		data-backdrop="true" data-keyboard="true" 
			        		href="javascript:;" 
			        		onclick="$('#confirm-modal #delete').attr('href', 
			        			'/customers/' + ${item.id} + '/delete');">
							Delete
			        	</a>
			        </td>
				</tr>
				% endfor
			</tbody>
		</table>
		
		## pager	
	    ${pager(customers)}
	    
	% else:
	<p>
		Customers not found!
	</p>
	% endif

	## delete confirm modal dialog	
    ${delete_modal("Are you sure you want to delete this customer?")}
	
  </div>
</div>

<%def name="sortable(column)">
    <% sort_column = request.GET.get("sort") if request.GET.get("sort") else "company_name" %>
    <% sort_direction = request.GET.get("direction") if request.GET.get("direction") else "asc" %>  
	<% css_class = "" %>
	% if (column == sort_column):
		<% css_class = "current " + sort_direction %>
	% endif
	
	<% direction = "asc" %>
	% if (column == sort_column and sort_direction == "asc"):
		<% direction = "desc" %>
	% endif

	% if column == "company_name":
		<a href="${request.route_url('customer_list')}?sort=${column}&direction=${direction}" 
			class="${css_class}">Company Name</a>
	% elif column == "contact_first_name":
		<a href="${request.route_url('customer_list')}?sort=${column}&direction=${direction}" 
			class="${css_class}">First Name</a>
	% elif column == "contact_last_name":
		<a href="${request.route_url('customer_list')}?sort=${column}&direction=${direction}" 
			class="${css_class}">Last Name</a>
	% else:
		<a href="${request.route_url('customer_list')}?sort=${column}&direction=${direction}" 
			class="${css_class}">Category</a>
	% endif
</%def>

